name: Generate groestlcoin.conf

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout source (current branch)
        uses: actions/checkout@v4
        with:
          repository: Groestlcoin/groestlcoin
          fetch-depth: 1

      - name: Install build dependencies (no GUI)
        run: |
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends \
            build-essential cmake pkgconf python3 \
            libevent-dev libboost-dev libsqlite3-dev \
            libcapnp-dev capnproto libzmq3-dev systemtap-sdt-dev

      - name: Configure (CMake, no GUI)
        run: |
          cmake -S . -B build \
            -DCMAKE_BUILD_TYPE=Release \
            -DBUILD_GUI=OFF \
            -DBUILD_TESTS=OFF

      - name: Build
        run: |
          cmake --build build -j "$(nproc)"

      - name: Generate share/examples/groestlcoin.conf
        run: |
          # devtools script expects BUILDDIR to point at the build dir
          BUILDDIR="$PWD/build" contrib/devtools/gen-groestlcoin-conf.sh
          test -f share/examples/groestlcoin.conf
          ls -lah share/examples/groestlcoin.conf

      - name: Upload groestlcoin.conf artifact
        uses: actions/upload-artifact@v4
        with:
          name: groestlcoin-conf
          path: share/examples/groestlcoin.conf
          if-no-files-found: error
